# Contributing to Meeting Notes Distiller

Thanks for your interest in contributing! This guide will help you get started.

## Development Setup

1. Fork and clone the repository
2. Install dependencies:
   ```bash
   npm install
   ```
3. Copy the environment file and add your API key:
   ```bash
   cp .env.local.example .env.local
   ```
4. Start the development server:
   ```bash
   npm run dev
   ```

## Running Tests

```bash
# Run the full test suite
npm test

# Run tests in watch mode during development
npm run test:watch
```

All 182 tests must pass before submitting a PR.

## Project Architecture

### Database Layer

The app uses **SQLite** via `better-sqlite3` with **Drizzle ORM** as a type-safe query builder.

- **Schema definition:** `lib/db/schema.ts` — Drizzle table definitions for `meetings` and `tasks`
- **Connection singleton:** `lib/db/index.ts` — `getDb()` returns a Drizzle DB instance wrapping `better-sqlite3`
- **Migrations:** `drizzle/` — SQL migration files generated by Drizzle Kit; `lib/db/migrate.ts` has the data backfill (`backfillTasks()`)
- **Drizzle config:** `drizzle.config.ts` — configures Drizzle Kit for migration generation

The database file is stored at `data/meetings.db` with WAL journaling and foreign keys enabled.

### Repository Pattern

Data access is separated from route handlers using the repository pattern:

- `lib/repositories/meetings.repository.ts` — `MeetingsRepository` (create, findById, list, delete)
- `lib/repositories/tasks.repository.ts` — `TasksRepository` (list, update, delete, reorder)
- `lib/repositories/index.ts` — `getRepositories()` factory that returns both repositories

API route handlers are thin HTTP wrappers: they parse the request, call the repository, and return the response.

### Database Migrations

Schema changes use Drizzle Kit to generate SQL migration files:

```bash
# After modifying lib/db/schema.ts, generate a new migration:
npm run db:generate

# For quick local dev (pushes schema directly, no migration file):
npm run db:push
```

Generated migrations live in `drizzle/` and run automatically on app startup via `drizzle-orm/better-sqlite3/migrator`. Commit the generated SQL files alongside your schema changes.

### Testing

Tests use in-memory SQLite databases via a shared helper (`__tests__/helpers/test-db.ts`). Repository unit tests instantiate repositories directly against the in-memory DB. API route tests mock the repository layer rather than the database directly.

## Code Style

- **TypeScript** in strict mode — no `any` types unless absolutely necessary
- **ESLint** enforced via `npm run lint`
- **Tailwind CSS** for styling — avoid inline styles

## How to Contribute

### Reporting Bugs

Open an issue using the [bug report template](.github/ISSUE_TEMPLATE/bug_report.md) and include:

- Steps to reproduce
- Expected vs actual behavior
- Browser and OS information

### Suggesting Features

Open an issue using the [feature request template](.github/ISSUE_TEMPLATE/feature_request.md) describing:

- The problem you're trying to solve
- Your proposed solution
- Any alternatives you've considered

### Submitting Pull Requests

1. Create a branch from `main`
2. Make your changes
3. Ensure all tests pass (`npm test`) and linting is clean (`npm run lint`)
4. Submit a PR using the [pull request template](.github/PULL_REQUEST_TEMPLATE.md)

## Commit Convention

This project follows [Conventional Commits](https://www.conventionalcommits.org/):

- `feat:` — new feature
- `fix:` — bug fix
- `docs:` — documentation changes
- `test:` — adding or updating tests
- `refactor:` — code changes that neither fix a bug nor add a feature
- `chore:` — maintenance tasks

Examples:
```
feat: add PDF export format
fix: handle empty notes input gracefully
docs: update environment variable documentation
```

## License

By contributing, you agree that your contributions will be licensed under the [AGPLv3](LICENSE).
